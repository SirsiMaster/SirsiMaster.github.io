<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Room Management - SirsiNexus</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.5.3"></script>
    <script>
      // Authentication check
      (function() {
        const auth = sessionStorage.getItem('investorAuth');
        if (!auth) {
          window.location.href = '../investor-login.html';
          return;
        }
        
        try {
          const authData = JSON.parse(auth);
          const loginTime = new Date(authData.loginTime);
          const now = new Date();
          const hoursSinceLogin = (now - loginTime) / (1000 * 60 * 60);
          
          if (hoursSinceLogin > 24) {
            sessionStorage.removeItem('investorAuth');
            window.location.href = '../investor-login.html';
            return;
          }
          
          console.log('✅ Authentication verified:', authData.id);
        } catch (error) {
          console.error('❌ Authentication error:', error);
          sessionStorage.removeItem('investorAuth');
          window.location.href = '../investor-login.html';
          return;
        }
      })();
    </script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              'inter': ['Inter', 'sans-serif'],
            },
            colors: {
              primary: {
                50: '#f0fdf4',
                100: '#dcfce7',
                200: '#bbf7d0',
                300: '#86efac',
                400: '#4ade80',
                500: '#22c55e',
                600: '#16a34a',
                700: '#15803d',
                800: '#166534',
                900: '#14532d'
              },
              secondary: {
                50: '#f8fafc',
                100: '#f1f5f9',
                200: '#e2e8f0',
                300: '#cbd5e1',
                400: '#94a3b8',
                500: '#64748b',
                600: '#475569',
                700: '#334155',
                800: '#1e293b',
                900: '#0f172a'
              }
            },
          },
        },
      }
    </script>
    <style>
        .file-drop-zone {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        .file-drop-zone.drag-over {
            border-color: #22c55e;
            background-color: rgba(34, 197, 94, 0.05);
        }
        .document-card:hover {
            transform: translateY(-2px);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="font-inter bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100">
<!-- Navigation and Layout Header -->
<div id="unified-header"></div>

<!-- Page Scripts -->
<script src="/SirsiNexusPortal/components/universal-navigation.js"></script>
<script src="/SirsiNexusPortal/components/navigation-customizer.js"></script>
<script src="/SirsiNexusPortal/assets/js/shared-theme-toggle.js"></script>

<!-- Authentication Check -->
<script>
    (function() {
        const auth = sessionStorage.getItem('investorAuth');
        if (!auth) {
            window.location.href = '/SirsiNexusPortal/investor-login.html';
            return;
        }
        
        try {
            const authData = JSON.parse(auth);
            const loginTime = new Date(authData.loginTime);
            const now = new Date();
            const hoursSinceLogin = (now - loginTime) / (1000 * 60 * 60);
            
            if (hoursSinceLogin > 24) {
                sessionStorage.removeItem('investorAuth');
                window.location.href = '/SirsiNexusPortal/investor-login.html';
                return;
            }
        } catch (error) {
            console.error('Authentication error:', error);
            sessionStorage.removeItem('investorAuth');
            window.location.href = '/SirsiNexusPortal/investor-login.html';
            return;
        }
    })();
</script>

<!-- Page-specific customization -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Get the current page from URL
        const path = window.location.pathname;
        const pageName = path.split('/').pop().replace('.html', '');
        
        // Add committee menu if we're in the committee section
        if (path.includes('/committee/')) {
            navCustomizer.addCommitteeMenu(pageName);
        }
        
        // Add action buttons based on page
        switch(pageName) {
            case 'data-room':
                navCustomizer.addActionButtons([{
                    label: 'Upload Document',
                    className: 'bg-emerald-600 text-white px-3 py-1.5 rounded-lg hover:bg-emerald-700 transition-colors',
                    onClick: () => showUploadModal()
                }]);
                break;
            case 'kpi-metrics':
                navCustomizer.addActionButtons([{
                    label: 'Export Report',
                    className: 'bg-blue-600 text-white px-3 py-1.5 rounded-lg hover:bg-blue-700 transition-colors',
                    onClick: () => exportMetrics()
                }]);
                break;
        }
    });
</script>

    <!-- Header -->
    <div id="unified-header"></div>

            <!-- Page Content -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-slate-50 dark:bg-slate-900">
                <div class="container mx-auto px-6 py-8">
                    <!-- Page Header -->
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-900 dark:text-slate-100">Data Room</h1>
                            <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">Access and manage your secure documents</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="relative">
                                <input type="text" id="searchInput" placeholder="Search documents..." class="w-64 px-4 py-2 pr-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                                <i data-lucide="search" class="w-4 h-4 text-slate-400 absolute right-3 top-1/2 -translate-y-1/2"></i>
                            </div>
                            <button id="uploadBtn" class="flex items-center gap-2 px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors">
                                <i data-lucide="upload" class="w-4 h-4"></i>
                                Upload Document
                            </button>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Total Documents -->
                        <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-primary-100 dark:bg-primary-900/20 rounded-lg flex items-center justify-center">
                                    <i data-lucide="files" class="w-6 h-6 text-primary-600 dark:text-primary-400"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-900 dark:text-slate-100" id="totalDocuments">0</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">Total Documents</div>
                                </div>
                            </div>
                        </div>
                        <!-- Recent Uploads -->
                        <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center">
                                    <i data-lucide="upload" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-900 dark:text-slate-100" id="recentUploads">0</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">Recent Uploads</div>
                                </div>
                            </div>
                        </div>
                        <!-- Total Size -->
                        <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900/20 rounded-lg flex items-center justify-center">
                                    <i data-lucide="hard-drive" class="w-6 h-6 text-yellow-600 dark:text-yellow-400"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-900 dark:text-slate-100" id="totalSize">0 B</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">Total Size</div>
                                </div>
                            </div>
                        </div>
                        <!-- Active Users -->
                        <div class="bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center">
                                    <i data-lucide="users" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-slate-900 dark:text-slate-100" id="activeUsers">1</div>
                                    <div class="text-sm text-slate-600 dark:text-slate-400">Active Users</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filters & Quick Actions -->
                    <div class="bg-white dark:bg-slate-800 rounded-xl p-6 mb-8 shadow-sm">
                        <div class="flex flex-col md:flex-row md:items-center gap-4">
                            <!-- Categories -->
                            <div class="flex-1">
                                <div class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Categories</div>
                                <div class="flex flex-wrap gap-2" id="categoryFilters">
                                    <!-- Category filters will be populated by JavaScript -->
                                </div>
                            </div>
                            <!-- View Toggle -->
                            <div class="flex items-center gap-2 ml-auto">
                                <button class="p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" data-view="grid">
                                    <i data-lucide="grid" class="w-5 h-5"></i>
                                </button>
                                <button class="p-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" data-view="list">
                                    <i data-lucide="list" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="documentsGrid">
                        <!-- Documents will be populated by JavaScript -->
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="text-center py-20 hidden">
                        <div class="w-24 h-24 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i data-lucide="file-text" class="w-12 h-12 text-slate-400"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100 mb-2">No documents found</h3>
                        <p class="text-slate-600 dark:text-slate-400 mb-6">Upload your first document to get started.</p>
                        <button onclick="document.getElementById('uploadBtn').click()" class="px-6 py-3 bg-primary-600 text-white text-base font-medium rounded-lg hover:bg-primary-700 transition-colors">
                            Upload Document
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-slate-800 rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold">Upload Document</h2>
                    <button onclick="closeUploadModal()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <!-- File Drop Zone -->
                <div id="dropZone" class="file-drop-zone border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-8 text-center mb-6">
                    <div class="mb-4">
                        <i data-lucide="upload-cloud" class="w-12 h-12 text-slate-400 mx-auto mb-2"></i>
                        <p class="text-lg font-medium text-slate-900 dark:text-slate-100 mb-1">Drop files here or click to upload</p>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Support for PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX (max 50MB)</p>
                    </div>
                    <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx" class="hidden">
                    <button onclick="document.getElementById('fileInput').click()" class="px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors">
                        Select Files
                    </button>
                </div>

                <!-- File List -->
                <div id="fileList" class="space-y-3 mb-6 hidden">
                    <!-- Files will be listed here -->
                </div>

                <!-- Upload Form -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Category</label>
                        <select id="documentCategory" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <option value="financial">Financial</option>
                            <option value="legal">Legal</option>
                            <option value="strategic">Strategic</option>
                            <option value="technical">Technical</option>
                            <option value="marketing">Marketing</option>
                            <option value="operations">Operations</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Access Level</label>
                        <select id="accessLevel" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <option value="public">Public - All authenticated users</option>
                            <option value="restricted">Restricted - Committee members only</option>
                            <option value="confidential">Confidential - Admin only</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Description (Optional)</label>
                        <textarea id="documentDescription" rows="3" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="Brief description of the document..."></textarea>
                    </div>
                </div>

                <!-- Upload Progress -->
                <div id="uploadProgress" class="mt-6 hidden">
                    <div class="bg-slate-200 dark:bg-slate-700 rounded-full h-2 mb-2">
                        <div id="progressBar" class="bg-primary-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p id="uploadStatus" class="text-sm text-slate-600 dark:text-slate-400"></p>
                </div>

                <!-- Actions -->
                <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200 dark:border-slate-700">
                    <button onclick="closeUploadModal()" class="px-4 py-2 text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 transition-colors">
                        Cancel
                    </button>
                    <button id="uploadButton" class="px-6 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        Upload Documents
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Preview Modal -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-slate-800 rounded-xl max-w-6xl w-full mx-4 max-h-[95vh] overflow-hidden flex flex-col">
            <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
                <h3 id="previewTitle" class="text-lg font-semibold"></h3>
                <div class="flex items-center gap-3">
                    <button id="downloadDocBtn" class="flex items-center gap-2 px-3 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        Download
                    </button>
                    <button onclick="closePreviewModal()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <div id="previewContent" class="flex-1 p-4 overflow-auto">
                <!-- Preview content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Load JavaScript -->
    <script src="assets/js/document-search.js"></script>
    <script src="assets/js/access-control.js"></script>
    <script src="assets/js/data-room-api.js"></script>
    <script src="assets/js/data-room-management.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            
            if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }
        
        function initTheme() {
            const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.classList.toggle('dark', theme === 'dark');
        }
        
        // Initialize theme
        initTheme();
        
        // Initialize data room when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, checking DataRoomManager...');
            if (typeof DataRoomManager !== 'undefined') {
                console.log('DataRoomManager found, initializing...');
                window.dataRoom = new DataRoomManager();
                console.log('DataRoom initialized:', window.dataRoom);
            } else {
                console.error('DataRoomManager not found!');
            }
        });
        
        // Reset function for debugging
        window.resetDataRoom = function() {
            if (confirm('This will clear all documents and reload with sample data. Continue?')) {
                localStorage.removeItem('sirsi_data_room_documents');
                location.reload();
            }
        };
    </script>
<script src="../js/telemetry.js"></script>

    
    <script>
        function toggleMobileSidebar() {
            const sidebar = document.querySelector('aside');
            sidebar.classList.toggle('hidden');
            sidebar.classList.toggle('block');
        }
        
        // Highlight active page
        document.addEventListener('DOMContentLoaded', function() {
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const sidebarLinks = document.querySelectorAll('aside a');
            
            sidebarLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href === currentPage || (currentPage === 'index.html' && href === 'index.html')) {
                    link.classList.remove('text-gray-700', 'dark:text-gray-300');
                    link.classList.add('text-blue-600', 'dark:text-blue-400', 'bg-blue-50', 'dark:bg-blue-900/20');
                }
            });
        });
    </script>
</body>
</html>
