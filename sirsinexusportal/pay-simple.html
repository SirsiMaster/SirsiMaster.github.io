<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Payment Test</title>
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=ASUI7q4yAs6anh26J6T_7hLyX0UwUbVWQS-8lgngn9z0W6VX4zrt2y7Q_auiXBAUrzxd1ibBrz22KDAr&currency=USD&components=buttons&enable-funding=venmo,paylater,card,applepay,googlepay"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin: 20px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; }
        #paypal-button-container { margin: 20px 0; min-height: 60px; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>Simple Payment Test</h1>
    
    <div class="form-group">
        <label for="amount">Payment Amount ($):</label>
        <input type="number" id="amount" min="1" max="10000" step="0.01" value="10.00">
        
        <!-- Fee Breakdown -->
        <div id="fee-breakdown" class="message info" style="display: none; margin-top: 10px; background: #fff3cd; border-color: #ffeaa7; color: #856404;">
            <strong>Fee Breakdown:</strong><br>
            Subtotal: <span id="fee-subtotal">$0.00</span><br>
            Processing Fee: <span id="fee-amount">$0.00</span> <small>(3.49% + $0.49)</small><br>
            <strong>Total to Pay: <span id="fee-total">$0.00</span></strong>
        </div>
    </div>
    
    <div class="form-group">
        <label for="description">Description:</label>
        <input type="text" id="description" value="Test Payment" placeholder="Payment description">
    </div>
    
    <div id="status" class="message info">Enter an amount and the PayPal buttons will appear below</div>
    
    <div id="paypal-button-container"></div>
    
    <script>
        let buttonsRendered = false;
        let currentTotalAmount = 0;
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `message ${type}`;
            statusDiv.textContent = message;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // PayPal Fee Calculation
        function calculatePayPalFees(amount) {
            const rate = 0.0349;
            const fixedFee = 0.49;
            const percentageFee = amount * rate;
            const totalFee = percentageFee + fixedFee;
            const totalAmount = amount + totalFee;
            
            return {
                percentageFee: Math.round(percentageFee * 100) / 100,
                totalFee: Math.round(totalFee * 100) / 100,
                totalAmount: Math.round(totalAmount * 100) / 100
            };
        }
        
        function updateFeeBreakdown() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const feeBreakdown = document.getElementById('fee-breakdown');
            
            if (amount > 0) {
                const feeData = calculatePayPalFees(amount);
                currentTotalAmount = feeData.totalAmount;
                
                // Show fee breakdown
                feeBreakdown.style.display = 'block';
                
                // Update fee breakdown values
                document.getElementById('fee-subtotal').textContent = `$${amount.toFixed(2)}`;
                document.getElementById('fee-amount').textContent = `$${feeData.totalFee.toFixed(2)}`;
                document.getElementById('fee-total').textContent = `$${feeData.totalAmount.toFixed(2)}`;
            } else {
                // Hide fee breakdown
                feeBreakdown.style.display = 'none';
                currentTotalAmount = 0;
            }
        }
        
        function renderPayPalButtons() {
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value || 'Payment';
            
            if (!amount || amount < 1) {
                updateStatus('Please enter an amount of $1 or more');
                updateFeeBreakdown(); // Update fee breakdown even for invalid amounts
                return;
            }
            
            // Update fee breakdown first
            updateFeeBreakdown();
            
            if (typeof paypal === 'undefined') {
                updateStatus('PayPal SDK not loaded', 'error');
                return;
            }
            
            // Clear existing buttons
            document.getElementById('paypal-button-container').innerHTML = '';
            buttonsRendered = false;
            
            updateStatus('Loading PayPal buttons...');
            
            try {
                paypal.Buttons({
                    createOrder: function(data, actions) {
                        // Use the total amount including fees
                        const totalAmount = currentTotalAmount || amount;
                        console.log('Creating order for:', { amount, totalAmount, description });
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    value: totalAmount.toFixed(2),
                                    currency_code: 'USD'
                                },
                                description: description + ` (includes processing fee)`
                            }]
                        });
                    },
                    onApprove: function(data, actions) {
                        updateStatus('Processing payment...');
                        return actions.order.capture().then(function(details) {
                            updateStatus(`Payment successful! Transaction: ${details.id}`, 'success');
                            console.log('Payment details:', details);
                        });
                    },
                    onError: function(err) {
                        updateStatus(`Payment error: ${err}`, 'error');
                        console.error('PayPal error:', err);
                    },
                    onCancel: function(data) {
                        updateStatus('Payment was cancelled');
                        console.log('Payment cancelled:', data);
                    }
                }).render('#paypal-button-container').then(function() {
                    buttonsRendered = true;
                    updateStatus('PayPal buttons loaded successfully!', 'success');
                }).catch(function(err) {
                    updateStatus(`Failed to load PayPal buttons: ${err}`, 'error');
                    console.error('Render error:', err);
                });
            } catch (error) {
                updateStatus(`JavaScript error: ${error.message}`, 'error');
                console.error('JavaScript error:', error);
            }
        }
        
        // Wait for PayPal SDK to load
        function initializePayPal() {
            if (typeof paypal !== 'undefined') {
                updateStatus('PayPal SDK loaded, rendering buttons...');
                renderPayPalButtons();
            } else {
                updateStatus('Waiting for PayPal SDK...');
                setTimeout(initializePayPal, 500);
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing PayPal...');
            updateStatus('Initializing PayPal...');
            
            // Start checking for PayPal SDK
            setTimeout(initializePayPal, 1000);
            
            // Re-render buttons when amount changes
            document.getElementById('amount').addEventListener('input', function() {
                if (buttonsRendered) {
                    renderPayPalButtons();
                }
            });
            
            document.getElementById('description').addEventListener('input', function() {
                if (buttonsRendered) {
                    renderPayPalButtons();
                }
            });
        });
    </script>
</body>
</html>
