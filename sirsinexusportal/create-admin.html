<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Admin User - SirsiNexus</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            sendEmailVerification,
            signInWithEmailAndPassword 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDFd4RAvVZWy3G1geLudrq4KgDDsGr-jb8",
            authDomain: "sirsi-nexus-live.firebaseapp.com",
            projectId: "sirsi-nexus-live",
            storageBucket: "sirsi-nexus-live.firebasestorage.app",
            messagingSenderId: "210890802638",
            appId: "1:210890802638:web:9b721753a295620422179f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.createAdmin = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = document.getElementById('name').value;
            
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');
            
            try {
                loadingDiv.classList.remove('hidden');
                resultDiv.innerHTML = '';
                
                // Create user
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Create user document with admin role
                await setDoc(doc(db, 'users', user.uid), {
                    uid: user.uid,
                    email: email,
                    name: name,
                    role: 'admin',
                    admin: true,
                    createdAt: new Date().toISOString(),
                    verified: false,
                    lastLogin: null,
                    photoURL: null,
                    developer: true,
                    investor: false
                });
                
                // Send verification email
                await sendEmailVerification(user);
                
                loadingDiv.classList.add('hidden');
                resultDiv.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="text-green-800 font-semibold mb-2">✅ Admin User Created Successfully!</h3>
                        <p class="text-green-700 text-sm mb-2">User ID: ${user.uid}</p>
                        <p class="text-green-700 text-sm mb-2">Email: ${email}</p>
                        <p class="text-green-700 text-sm">Verification email sent. Please check your inbox.</p>
                    </div>
                `;
                
                // Clear form
                document.getElementById('createForm').reset();
            } catch (error) {
                loadingDiv.classList.add('hidden');
                resultDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-red-800 font-semibold mb-2">❌ Error Creating Admin</h3>
                        <p class="text-red-700 text-sm">${error.message}</p>
                    </div>
                `;
            }
        }
        
        window.testLogin = async function() {
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            const testResult = document.getElementById('testResult');
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Get user document
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                const userData = userDoc.data();
                
                testResult.innerHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="text-blue-800 font-semibold mb-2">✅ Login Successful!</h3>
                        <p class="text-blue-700 text-sm mb-1">Name: ${userData?.name}</p>
                        <p class="text-blue-700 text-sm mb-1">Role: ${userData?.role}</p>
                        <p class="text-blue-700 text-sm mb-1">Admin: ${userData?.admin ? 'Yes' : 'No'}</p>
                        <p class="text-blue-700 text-sm">Email Verified: ${user.emailVerified ? 'Yes' : 'No'}</p>
                    </div>
                `;
            } catch (error) {
                testResult.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-red-800 font-semibold mb-2">❌ Login Failed</h3>
                        <p class="text-red-700 text-sm">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Initialize initial data
        window.initializeData = async function() {
            const statusDiv = document.getElementById('initStatus');
            
            try {
                statusDiv.innerHTML = '<p class="text-blue-600">Initializing data...</p>';
                
                // Create initial KPI data
                await setDoc(doc(db, 'kpis', 'current'), {
                    timestamp: new Date().toISOString(),
                    revenue: {
                        current: 2847000,
                        target: 3000000,
                        growth: 18.5
                    },
                    users: {
                        total: 48293,
                        active: 12847,
                        new: 2847,
                        churn: 2.3
                    },
                    infrastructure: {
                        servers: 24,
                        uptime: 99.97,
                        responseTime: 124
                    },
                    updated: new Date().toISOString()
                });
                
                // Create initial investor metrics
                await setDoc(doc(db, 'investorMetrics', 'summary'), {
                    totalInvestors: 147,
                    accreditedInvestors: 89,
                    totalCommitted: 4750000,
                    averageTicket: 32313,
                    conversionRate: 60.5,
                    updated: new Date().toISOString()
                });
                
                statusDiv.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="text-green-800 font-semibold">✅ Data Initialized!</h3>
                        <p class="text-green-700 text-sm">KPIs and metrics have been created.</p>
                    </div>
                `;
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-red-800 font-semibold">❌ Initialization Failed</h3>
                        <p class="text-red-700 text-sm">${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</head>
<body class="font-inter bg-gray-50 min-h-screen py-12">
    <div class="max-w-6xl mx-auto px-4">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">SirsiNexus Firebase Setup</h1>
            <p class="text-gray-600 mt-2">Create admin users and initialize data</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Create Admin User -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4">Create Admin User</h2>
                <form id="createForm" onsubmit="event.preventDefault(); createAdmin();">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" id="name" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Admin Name">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="email" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="admin@sirsi.ai">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" required minlength="6"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Minimum 6 characters">
                    </div>
                    <button type="submit" 
                            class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                        Create Admin Account
                    </button>
                </form>
                <div id="loading" class="hidden mt-4 text-center">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                </div>
                <div id="result" class="mt-4"></div>
            </div>
            
            <!-- Test Login -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4">Test Login</h2>
                <form onsubmit="event.preventDefault(); testLogin();">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="testEmail" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="test@sirsi.ai">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="testPassword" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Password">
                    </div>
                    <button type="submit" 
                            class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors">
                        Test Login
                    </button>
                </form>
                <div id="testResult" class="mt-4"></div>
            </div>
        </div>
        
        <!-- Initialize Data -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-8">
            <h2 class="text-xl font-semibold mb-4">Initialize Firebase Data</h2>
            <p class="text-gray-600 mb-4">This will create initial KPIs, metrics, and sample data in Firestore.</p>
            <button onclick="initializeData()" 
                    class="bg-purple-600 text-white py-2 px-6 rounded-md hover:bg-purple-700 transition-colors">
                Initialize Data
            </button>
            <div id="initStatus" class="mt-4"></div>
        </div>
        
        <!-- Status Information -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-8">
            <h3 class="text-lg font-semibold text-blue-900 mb-2">Firebase Project Status</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                    <p class="text-blue-800 font-medium">Project ID:</p>
                    <code class="text-blue-700">sirsi-nexus-live</code>
                </div>
                <div>
                    <p class="text-blue-800 font-medium">Auth Domain:</p>
                    <code class="text-blue-700">sirsi-nexus-live.firebaseapp.com</code>
                </div>
                <div>
                    <p class="text-blue-800 font-medium">Console:</p>
                    <a href="https://console.firebase.google.com/project/sirsi-nexus-live" target="_blank" 
                       class="text-blue-600 underline">Open Firebase Console →</a>
                </div>
                <div>
                    <p class="text-blue-800 font-medium">Live Site:</p>
                    <a href="https://sirsi.ai" target="_blank" class="text-blue-600 underline">sirsi.ai →</a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
